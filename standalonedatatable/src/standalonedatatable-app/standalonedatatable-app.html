<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/bwt-datatable/bwt-datatable.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">

<dom-module id="standalonedatatable-app">
  <template>
    <style>
      :host {
        display: block;
      }
      #tabl
      {
        width: 50%;
        float:left;
      }
      #modifcard{
        width:50%;
        float:right;
      }
    </style>
      <!-- chargement du fichier dat.json sensé contenir mes datas -->
    <iron-ajax       
                
      id="fetchnotes"
      url="http://127.0.0.1:3000/notes/"
      method="GET"
      handle-as="json"
      on-response="_handleResponse"
      on-error="_error"></iron-ajax>

    <iron-ajax                
      id="createnotes"
      url="http://127.0.0.1:3000/notes/"
      method="POST"
      body="{{displayedItem}}" 
      handle-as="json"
      on-error="_error"></iron-ajax>
    <h2>Hello [[prop1]]!</h2> <!-- juste un test pour voir si le selection changed fonctionne bien-->

    <!-- Le tableau avec les datas-->
  <div id="tabl">
    <paper-datatable ref="itemList" id="tableau" data="{{datatab}}" selectable selected-item="{{selectedItem}}" >
      <paper-datatable-column header="Title" property="title" style="width:20%;"  sortable></paper-datatable-column>
      <paper-datatable-column header="Content" property="content" type="string" style="width:99%;height:99%;"  sortable></paper-datatable-column>
    </paper-datatable>
  </div>
  <!-- La datacard qui permet normalement de faire les modif, ne pas oublier de bien binder dans les deux sens avec {} -->
  <!-- Le type date s'ecrit au format yyyy-mm-dd -->
  <div id="modifcard">
    <paper-card style="min-width:300px;margin:10px;" heading="Selected item">
      <div style="padding:0px 16px 16px 16px">
       <!-- <paper-input value="{{displayedItem.id}}" label="ID"></paper-input> -->
        <paper-input value="{{displayedItem.title}}" label="Title"></paper-input>
        <paper-input value="{{displayedItem.content}}" label="Content"></paper-input>
      </div>
    </paper-card>



    <h3>[[selectedItem.id]]</h3>
    <h3>[[prop2]]</h3>

  </div>
  <div id="buttons">

    <paper-button  on-click="_displayBlank">new</paper-button>
    <paper-button  on-click="_saveNewData">save</paper-button>
    <paper-button  on-click="_reload">Le Reload Button</paper-button>
    <paper-button  on-click="_loadData">Load Data</paper-button>
  </div>

  </template>

  <script>
    /**
     * @customElement
     * @polymer
     */
             
    class StandalonedatatableApp extends Polymer.Element {

      
      static get is() { return 'standalonedatatable-app'; }
      static get properties() {
        return {
          prop1: {
            type: String
          },
          prop2: {
            type: String,
            value:"not clicked yet"
          },
          //les datas de base en cas de non-chargement 
          datatab:{
            type:Array,
            value:[{id: 0, title:"T'as un soucis, t'as pas de data", calories: "Over 9000", fat: "lot", carbs: 24, protein: 4, sodium: 87, calcium:.14, iron: .01},
                    ]
                    ,
          },
          //
          selectedItem:{
            type:Object,
            observer:'_selectionChanged',
            value:{}
          },
          displayedItem:{
            type:Object,
            value:[{title:"",content:""}]
          },
          ajaxdatatab:{
            type:Array
          }
        };
      }
      _selectionChanged(newValue, oldValue) // juste pour voir si ca se trigger bien
      {
          this.prop1="Selection Changed";
          this.displayedItem=this.selectedItem;

      }
      _loadData() //sert à charger les notes
      {
        this.$.fetchnotes.generateRequest();
      }
      _saveNewData() //sert à charger les notes
      {
        this.$.createnotes.generateRequest();
      }
      _handleResponse(event) //appelé quand le json est chargé
      {
        // faire bien attention à la propriété à aller rechercher (difference avec le codelabs, pas de .dat sur la response)
        this.ajaxdatatab=event.detail.response;
        this.datatab=this.ajaxdatatab;
        this.prop1="response";
      }
      _error(event)
      {
        this.prop2="Hum, ya un problème doc";
      }
      _displayBlank(event){
        this.displayedItem=[{title:"",content:""}];
        this.prop1="Blank clicked"
        var x=this.shadowRoot.querySelector("#tableau");
        console.log(x);
        x.deselectAll();
      }
      _displaySave(event)
      {
        this.displayedItem=[{title:"",calories:"",fat:"",carbs:"",protein:"",sodium:"",calcium:"",iron:""}];
        
      }
      _reload(event){
        this.prop2="Reload";
        var x=this.shadowRoot.querySelector("#tableau");
        console.log(x);
        x.reload();
      }
    }

    window.customElements.define(StandalonedatatableApp.is, StandalonedatatableApp);
  </script>
</dom-module>
